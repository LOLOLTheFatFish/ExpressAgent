<view class="page-container">
  
  <view class="search-view" wx:if="{{!showChat}}">
    <view class="illustration-container">
        <view class="glow-effect"></view>
        <view class="package-image">
            <image src="https://lh3.googleusercontent.com/aida-public/AB6AXuB2pyueGaNYfMC4fnx2H_BcnVYsjn5PapFHmIGeeiKtEEX-YMIdtWQwmYzfcWV8gYY7nn8QbfeATxH1TcEJpXr2kH7ao6705SVP-I_Dsu9xkSDllKSwNsicfVW2YSavkUr2sMJcKZF1cxgiLBKraIT_ot-bcsv3Kksn9XYEqv1Y69CBURGVCW_8DSdXM8em0ShzvjjM3IMReLwHJramhjzcfaUrJLTY_1REyvyvVsl1QBDLxzNDkHk-w_u9rTWfrfwjLBoFYJLyxyI" mode="aspectFill" class="map-image"></image>
        </view>
    </view>
    
    <text class="page-title">Package Search</text>
    
    <view class="search-box-container">
      <input class="search-input" placeholder="è¾“å…¥ 1/2/3 å¹¶å›è½¦" confirm-type="search" bindconfirm="onSearchConfirm" value="{{inputValue}}" bindinput="onInput" />
      <view class="search-icons">
        <view class="icon-btn"><text>âœ¨</text></view>
        <view class="icon-btn"><text>ğŸ“·</text></view>
      </view>
    </view>
  </view>

  <scroll-view class="main-content chat-view" scroll-y scroll-top="{{scrollTop}}" scroll-with-animation wx:if="{{showChat}}">
    <view class="date-divider">
      <text class="date-badge">Today</text>
    </view>

    <block wx:for="{{msgList}}" wx:key="index">
      
      <view class="msg-wrapper user" wx:if="{{item.type === 'user'}}">
        <view class="msg-content">
          <view class="bubble user"><text>{{item.content}}</text></view>
          <text class="user-label">You</text>
        </view>
        <view class="avatar"><text>ğŸ‘¤</text></view>
      </view>

      <view class="msg-wrapper assistant" wx:if="{{item.type === 'assistant'}}">
        <view class="avatar"><text>ğŸ¤–</text></view>
        <view class="msg-content">
      
            <view class="card" wx:if="{{item.template === 'normal'}}" bindtap="onCardTap" data-code="{{item.data.pickupCode}}" data-status="{{item.data.statusText}}" data-type="normal">
                <view class="card-header normal">
                    <text class="text-blue">âœ…</text>
                    <text class="card-status-text text-blue">{{item.data.statusText}}</text>
                </view>
                <view class="card-body">
                    <text class="pickup-code text-blue">{{item.data.pickupCode}}</text>
                    <text class="pickup-label">å–ä»¶ç </text>
                </view>
                <view class="card-map">
                    <image class="map-image" src="{{item.data.mapImageUrl}}" mode="aspectFill"></image>
                    <view class="map-pin"><text>ğŸ“</text></view>
                </view>
            </view>

            <view class="card" wx:if="{{item.template === 'closed'}}" bindtap="onCardTap" data-code="{{item.data.pickupCode}}" data-status="{{item.data.statusText}}" data-type="closed">
                <view class="card-header closed">
                    <text class="text-yellow">âš ï¸</text>
                    <text class="card-status-text text-yellow">{{item.data.statusText}}</text>
                </view>
                <view class="card-body">
                    <text class="pickup-code text-yellow">{{item.data.pickupCode}}</text>
                    <text class="pickup-label">å–ä»¶ç </text>
                </view>
                <view class="card-map">
                    <image class="map-image" src="{{item.data.mapImageUrl}}" mode="aspectFill"></image>
                    <view class="map-pin"><text>ğŸ“</text></view>
                </view>
            </view>

            <view class="card" wx:if="{{item.template === 'error'}}">
                <view class="card-error-body">
                    <view class="error-icon-wrapper">
                        <text style="font-size: 48px;">ğŸ“¦</text>
                        <view style="position: absolute; top: -4px; right: -4px; background: white; border-radius: 50%; padding: 2px;">â“</view>
                    </view>
                    <text class="error-title">Package Missing?</text>
                    <text class="error-desc">We can help you locate it.</text>
                </view>
                <view class="error-actions">
                    <button class="btn-primary" hover-class="opacity-90">Call Support</button>
                    <button class="btn-secondary" hover-class="bg-gray-50">Report Issue</button>
                </view>
            </view>

        </view>
      </view>

    </block>

    <view class="msg-wrapper assistant" wx:if="{{isLoading}}">
        <view class="avatar"><text>ğŸ¤–</text></view>
        <view class="loading-dots">
            <view class="dot"></view>
            <view class="dot"></view>
            <view class="dot"></view>
        </view>
    </view>
    
    <view style="height: 20px;"></view>

  </scroll-view>

  <view class="input-area" wx:if="{{showChat}}">
    <view class="input-wrapper">
      <input class="chat-input" placeholder="è¾“å…¥ 1/2/3 æ¨¡æ‹Ÿå›å¤" confirm-type="send" bindconfirm="onSend" value="{{inputValue}}" bindinput="onInput" />
      <view class="send-btn" bindtap="onSend"><text>â¬†ï¸</text></view>
    </view>
  </view>

  <view class="bottom-tab-bar">
    <view class="tab-item">
      <view class="tab-icon-bg"><text class="tab-icon">ğŸ”</text></view>
      <text class="tab-text active">Search</text>
    </view>
    
    <view class="tab-item" bindtap="onTapHistory">
      <view class="tab-icon-wrapper"><text class="tab-icon-gray">ğŸ•’</text></view>
      <text class="tab-text">History</text>
    </view>
    
    <view class="tab-item" bindtap="onTapProfile">
      <view class="tab-icon-wrapper"><text class="tab-icon-gray">ğŸ‘¤</text></view>
      <text class="tab-text">Profile</text>
    </view>
  </view>

</view>
